<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Risk Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Roboto+Mono:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="game-container">
      <header class="header">
        <h1>AI Risk Game</h1>
      </header>

      <main class="main">
        <section class="board">
          <div class="map-shell">
            <canvas id="gameMap" width="1000" height="600">Your browser does not support canvas.</canvas>
            <div id="map-controls" class="map-controls">
              <button id="map-zoom-in" class="map-control-btn" type="button" aria-label="Zoom In">+</button>
              <button id="map-zoom-out" class="map-control-btn" type="button" aria-label="Zoom Out">-</button>
              <button id="map-reset" class="map-control-btn map-control-reset" type="button">Reset</button>
            </div>
            <div id="battle-log-panel" class="battle-log-panel collapsed">
              <button id="battle-log-toggle" class="battle-log-toggle" type="button">LOG</button>
              <div id="battle-log-content" class="battle-log-content" aria-hidden="true">
                <textarea id="gameLog" rows="8" readonly></textarea>
              </div>
            </div>
            <div id="territory-tooltip" class="territory-tooltip" aria-hidden="true"></div>
          </div>
        </section>

        <aside id="sidebar" class="sidebar">
          <div id="top-panel" class="top-panel">
            <section class="hud-section phase-section tactical-header">
              <div class="section-title">Battle Command</div>
              <div class="phase-row">
                <div id="currentPhase" class="phase-badge">LOBBY</div>
                <div id="currentPlayer" class="current-player-label">Waiting for game...</div>
              </div>
              <button id="btn-cards" class="btn btn-secondary cards-hud-btn" type="button">
                CARDS (0)
              </button>
              <div id="turn-timer-bar" class="turn-timer-bar hidden" aria-hidden="true">
                <div id="turn-timer-fill" class="turn-timer-fill"></div>
                <div id="turn-timer-label" class="turn-timer-label">TURN TIMER</div>
              </div>
            </section>

            <section class="hud-section players-section">
              <div class="section-title">Commanders</div>
              <div id="playerList" class="player-cards"></div>
            </section>
          </div>

          <div id="bottom-controls" class="bottom-controls">
            <button id="rules-btn" class="btn btn-secondary rules-btn hidden" type="button">
              HOW TO PLAY
            </button>
            <div id="dynamic-actions-container"></div>
          </div>
        </aside>
      </main>
    </div>

    <div id="battle-overlay" aria-hidden="true">
      <div class="battle-panel">
        <h2 id="battle-title">Battle</h2>
        <div id="battle-overlay-state"></div>
        <div id="battle-dice-container"></div>
      </div>
    </div>

    <div id="combat-arena-modal" class="combat-arena-modal" aria-hidden="true">
      <div id="combat-arena-panel" class="combat-arena-panel" role="dialog" aria-modal="true">
        <div id="combat-arena-title" class="combat-arena-title">COMBAT ARENA</div>
        <div id="combat-arena-subtitle" class="combat-arena-subtitle">Preparando duelo...</div>
        <div id="combat-arena-dice-choices" class="combat-arena-dice-choices"></div>
        <button id="combat-arena-roll-btn" class="btn combat-arena-roll-btn" type="button">
          TIRAR DADOS
        </button>
        <div id="combat-arena-status" class="combat-arena-status"></div>
      </div>
      <div id="combat-arena-spectator" class="combat-arena-spectator">
        Batalla en curso...
      </div>
    </div>

    <div id="action-modal-backdrop" class="action-modal-backdrop" aria-hidden="true">
      <div id="action-modal-panel" class="action-modal-panel" role="dialog" aria-modal="true">
        <button id="action-modal-close" class="action-modal-close" type="button" aria-label="Cerrar">
          x
        </button>
        <h3 id="action-modal-title">ACTION</h3>
        <div id="action-modal-body"></div>
        <div id="action-modal-footer"></div>
      </div>
    </div>

    <div id="card-overlay" class="card-overlay" aria-hidden="true">
      <div class="card-panel" role="dialog" aria-modal="true" aria-labelledby="card-overlay-title">
        <button id="card-overlay-close" class="action-modal-close" type="button" aria-label="Cerrar">
          x
        </button>
        <h3 id="card-overlay-title">TACTICAL CARD VAULT</h3>
        <div id="card-overlay-subtitle" class="card-overlay-subtitle">Select 3 valid cards to trade in.</div>
        <div id="card-grid" class="card-grid"></div>
        <div id="card-overlay-footer" class="card-overlay-footer">
          <button id="card-cancel-btn" class="btn btn-secondary" type="button">CLOSE</button>
          <button id="card-trade-btn" class="btn btn-primary" type="button" disabled>TRADE IN</button>
        </div>
      </div>
    </div>

    <div id="card-reveal-overlay" class="card-reveal-overlay" aria-hidden="true">
      <div class="card-reveal-panel" role="dialog" aria-modal="true" aria-labelledby="card-reveal-title">
        <div id="card-reveal-title" class="card-reveal-title">NEW INTEL ACQUIRED</div>
        <div id="card-reveal-card" class="card-item card-reveal-card">
          <div id="card-reveal-type" class="card-type-pill">INFANTRY</div>
          <div id="card-reveal-icon" class="card-icon">‚öî</div>
          <div id="card-reveal-name" class="card-name">Territory</div>
        </div>
        <button id="card-reveal-claim-btn" class="btn btn-primary card-reveal-claim-btn" type="button">
          CLAIM
        </button>
      </div>
    </div>

    <div id="rules-modal" class="rules-modal" aria-hidden="true">
      <div class="rules-panel" role="dialog" aria-modal="true" aria-labelledby="rules-title">
        <button id="rules-close-btn" class="action-modal-close" type="button" aria-label="Close">
          x
        </button>
        <h2 id="rules-title">FIELD MANUAL &amp; TACTICS</h2>
        <div class="rules-content">
          <section class="rules-section">
            <h3>üéØ OBJECTIVE</h3>
            <p><strong>Conquer the world</strong> by eliminating all opponents.</p>
          </section>

          <section class="rules-section">
            <h3>‚öîÔ∏è TURN PHASES</h3>
            <ol>
              <li>
                <strong>DEPLOY:</strong>
                Receive troops based on territories (min 3) + Continent Bonuses. Place them
                strategically.
              </li>
              <li>
                <strong>ATTACK:</strong>
                Choose a source (&gt;1 troop) and a neighbor enemy. Roll dice (Best of 3 vs Best of 2).
              </li>
              <li>
                <strong>FORTIFY:</strong>
                Move troops between your connected territories to secure borders.
              </li>
            </ol>
          </section>

          <section class="rules-section">
            <h3>üó∫Ô∏è CONTINENT BONUSES</h3>
            <div class="rules-bonus-grid">
              <div><strong>Asia</strong><span>+7</span></div>
              <div><strong>Europe</strong><span>+5</span></div>
              <div><strong>North America</strong><span>+5</span></div>
              <div><strong>Africa</strong><span>+3</span></div>
              <div><strong>South America</strong><span>+2</span></div>
              <div><strong>Australia</strong><span>+2</span></div>
            </div>
          </section>

          <section class="rules-section">
            <h3>üÉè CARDS &amp; TRADE-IN</h3>
            <ul>
              <li>Conquer at least <strong>1 territory</strong> to draw a card.</li>
              <li>
                Collect sets (<strong>3 of a kind</strong> or <strong>1 of each</strong>) to trade
                for massive troops (4, 6, 8, 10...).
              </li>
            </ul>
          </section>
        </div>
      </div>
    </div>

    <div id="welcome-overlay" class="modal-overlay active" aria-hidden="false">
      <div class="modal-card">
        <h2>Bienvenido, Comandante</h2>
        <p>Elige un nickname para entrar al lobby.</p>
        <form id="welcome-form">
          <input
            id="nickname-input"
            type="text"
            maxlength="12"
            autocomplete="off"
            placeholder="Nickname (max 12)"
            required
          />
          <button id="welcome-submit" class="btn btn-primary" type="submit">ENTRAR</button>
        </form>
      </div>
    </div>

    <div id="victory-overlay" class="victory-overlay" aria-hidden="true">
      <canvas id="victory-confetti" class="victory-confetti"></canvas>
      <div class="victory-panel">
        <h2 id="victory-title">VICTORY!</h2>
        <p id="victory-winner">Ganador</p>
        <button id="return-lobby-btn" class="btn btn-primary" type="button">VOLVER AL LOBBY</button>
      </div>
    </div>

    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <script src="client.js"></script>
  </body>
</html>
